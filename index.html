<!DOCTYPE html>
<html>

<head>
  <title>Publish Subscribe Tutorial</title>
</head>

<body>
  <div id="alice">
    <p>Alice</p>
    <div class="messages"></div>
    <input class="publish-button" type="submit" data-author="alice" value="Click here to publish as Alice" />
  </div>
  <div id="bob">
    <p>Bob</p>
    <div class="messages"></div>
    <input class="publish-button" type="submit" data-author="bob" value="Click here to publish as Bob" />
  </div>
</body>

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.7.min.js"></script>
<script>
  const pubnub = new PubNub({
    publishKey: "YOUR_PUBLISH_KEY",
    subscribeKey: "YOUR_SUBSCRIBE_KEY"
  });

  const messagingChannel = "messaging_channel"

  const buttons = document.getElementsByClassName('publish-button');
  let index;

  for (index = 0; index < buttons.length; index++) {
    let button = buttons[index];
    button.addEventListener('click', ({ target }) => {
      const message = {
        author: target.dataset.author,
        text: "Message text"
      }
      console.log(message)
      pubnub.publish({
        channel: messagingChannel,
        message
      }, function(status, response) {
        //Handle error here
      });
    });
  }


  pubnub.subscribe({
    channels: [messagingChannel]
  });

  pubnub.addListener({
    message: function(event) {
      let pElement = document.createElement('p');
      pElement.appendChild(document.createTextNode(event.message.text));
      document.body.appendChild(pElement);
    }
  });
</script></html>
